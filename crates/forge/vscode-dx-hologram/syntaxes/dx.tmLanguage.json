{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "DX Config",
  "scopeName": "source.dx",
  "patterns": [
    { "include": "#comment" },
    { "include": "#table-header" },
    { "include": "#caret-key-value" },
    { "include": "#array-line" },
    { "include": "#key-value-indented" },
    { "include": "#key-value-dotted" },
    { "include": "#key-value-simple" },
    { "include": "#operators" }
  ],
  "repository": {
    "comment": {
      "patterns": [
        {
          "name": "comment.line.number-sign.dx",
          "match": "^\\s*#.*$"
        },
        {
          "name": "comment.line.double-slash.dx",
          "match": "//.*$"
        }
      ]
    },
    "caret-key-value": {
      "patterns": [
        {
          "comment": "Caret prefix key:value like ^container : none",
          "match": "^(\\^)([a-zA-Z_][a-zA-Z0-9_./\\-]*)\\s*(:)\\s*(.*)$",
          "captures": {
            "1": { "name": "keyword.control.caret.dx" },
            "2": { "name": "support.type.property-name.dx" },
            "3": { "name": "punctuation.separator.key-value.dx" },
            "4": { "patterns": [{ "include": "#values" }] }
          }
        }
      ]
    },
    "table-header": {
      "patterns": [
        {
          "comment": "Table column headers (capitalized words)",
          "name": "entity.name.class.dx",
          "match": "^[A-Z][a-zA-Z0-9_]*(?=\\s{2,}|$)"
        }
      ]
    },
    "array-line": {
      "patterns": [
        {
          "comment": "Array with arrow: key > items",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_./-]*)\\s*(>)\\s*(.*)$",
          "captures": {
            "2": { "name": "entity.name.function.dx" },
            "3": { "name": "keyword.operator.arrow.dx" },
            "4": { "patterns": [{ "include": "#array-items" }] }
          }
        }
      ]
    },
    "array-items": {
      "patterns": [
        {
          "name": "keyword.operator.pipe.dx",
          "match": "\\|"
        },
        {
          "name": "string.unquoted.array-item.dx",
          "match": "[a-zA-Z0-9_\\-./]+"
        }
      ]
    },
    "key-value-indented": {
      "patterns": [
        {
          "comment": "Indented key:value (child properties)",
          "match": "^(\\s{3,})([a-zA-Z_][a-zA-Z0-9_./\\-]*)\\s*(:)\\s*(.*)$",
          "captures": {
            "2": { "name": "support.type.property-name.dx" },
            "3": { "name": "punctuation.separator.key-value.dx" },
            "4": { "patterns": [{ "include": "#values" }] }
          }
        }
      ]
    },
    "key-value-dotted": {
      "patterns": [
        {
          "comment": "Dotted key:value like forge.repository",
          "match": "^([a-zA-Z_][a-zA-Z0-9_]*)(\\.)(\\w+)\\s*(:)\\s*(.*)$",
          "captures": {
            "1": { "name": "entity.name.namespace.dx" },
            "2": { "name": "punctuation.accessor.dx" },
            "3": { "name": "variable.other.property.dx" },
            "4": { "name": "punctuation.separator.key-value.dx" },
            "5": { "patterns": [{ "include": "#values" }] }
          }
        }
      ]
    },
    "key-value-simple": {
      "patterns": [
        {
          "comment": "Simple key:value",
          "match": "^([a-zA-Z_][a-zA-Z0-9_]*)\\s*(:)\\s*(.*)$",
          "captures": {
            "1": { "name": "variable.other.readwrite.dx" },
            "2": { "name": "punctuation.separator.key-value.dx" },
            "3": { "patterns": [{ "include": "#values" }] }
          }
        }
      ]
    },
    "values": {
      "patterns": [
        {
          "comment": "URL values",
          "name": "markup.underline.link.dx",
          "match": "https?://[^\\s]+"
        },
        {
          "comment": "Path values @/...",
          "name": "string.interpolated.dx",
          "match": "@/[a-zA-Z0-9_/\\-.*]+"
        },
        {
          "comment": "Glob patterns",
          "name": "string.regexp.dx",
          "match": "\\*\\*?(/[a-zA-Z0-9_.*]+)*"
        },
        {
          "comment": "Quoted strings",
          "name": "string.quoted.double.dx",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "name": "constant.character.escape.dx", "match": "\\\\." }
          ]
        },
        {
          "comment": "Version numbers",
          "name": "constant.numeric.version.dx",
          "match": "\\d+\\.\\d+\\.\\d+"
        },
        {
          "comment": "Numbers",
          "name": "constant.numeric.dx",
          "match": "-?\\d+(\\.\\d+)?"
        },
        {
          "comment": "Boolean true",
          "name": "constant.language.boolean.true.dx",
          "match": "\\b(true|yes)\\b"
        },
        {
          "comment": "Boolean false",
          "name": "constant.language.boolean.false.dx",
          "match": "\\b(false|no)\\b"
        },
        {
          "comment": "Null/none",
          "name": "constant.language.null.dx",
          "match": "\\b(null|none)\\b"
        },
        {
          "comment": "Special 'all' keyword",
          "name": "keyword.other.all.dx",
          "match": "\\ball\\b"
        },
        {
          "comment": "Package/scope reference",
          "name": "entity.name.tag.dx",
          "match": "@[a-zA-Z0-9_\\-/]+"
        },
        {
          "comment": "Simple string value",
          "name": "string.unquoted.dx",
          "match": "[a-zA-Z0-9_\\-./]+"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.control.caret.dx",
          "match": "\\^"
        },
        {
          "name": "keyword.operator.arrow.dx",
          "match": ">"
        },
        {
          "name": "keyword.operator.pipe.dx",
          "match": "\\|"
        },
        {
          "name": "keyword.operator.at.dx",
          "match": "@\\d*"
        },
        {
          "name": "keyword.operator.hash.dx",
          "match": "#"
        },
        {
          "name": "punctuation.separator.key-value.dx",
          "match": ":"
        }
      ]
    }
  }
}
